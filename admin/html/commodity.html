<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../myModal/css/jquery.my-modal.1.1.winStyle.css">
    <link rel="stylesheet" href="./css/form.css">
    <script type="text/javascript" src="../layer/layer.js"></script>
    <script type="text/javascript" src="../myModal/js/jquery.my-modal.1.1.js"></script>
    <script type="text/javascript" src="../js/jqueryform.js"></script>



    <style>
        .addCommodity{
            float: right;
            height: 40px;
            line-height: 40px;
            width: 140px;
            background: #ccc;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 60px;
        }
    </style>
</head>
<body>
<div>
    <div>
        <p class="addCommodity">添加商品</p>
    </div>
    <form action="" id="commodityFrom">
        <table class="table" style="margin: 0 auto;">

        </table>
    </form>
    <div id="commodityEdit" class="userEdit EditDiv">
        <h1>添加商品</h1>
        <form action="" id="addForm" method="post">
            <table class="EditTable">
                <tr>
                    <th>商品分类</th>
                    <td>
                        <select name="goodsCategory">
                            <option value="6">水果</option>
                            <option value="1">杂货</option>
                            <option value="2">家用</option>
                            <option value="3">个人护理</option>
                            <option value="4">包装食品</option>
                            <option value="5">饮料&酒水</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th>商品类型</th>
                    <td>
                        <select name="goodsType">
                            <option value="1">今日热卖</option>
                            <option value="2">今日优惠</option>
                            <option value="3">新品推荐</option>
                        </select>
                    </td>
                </tr>
                <tr>
                    <th>商品名称</th>
                    <td>
                        <input type="text" name="goodsName">
                    </td>
                </tr>
                <tr>
                    <th>商品简介</th>
                    <td>
                        <input type="text" name="goodsIntroduce">
                    </td>
                </tr>
                <tr>
                    <th>原价（元）</th>
                    <td>
                        <input type="text" name="goodsPrice">
                    </td>
                </tr>
                <tr>
                    <th>现价（元）</th>
                    <td>
                        <input type="text" name="goodsOfferPrice">
                    </td>
                </tr>
                <tr>
                    <th>数量</th>

                    <td>
                        <input type="text" name="goodsNum">
                    </td>
                </tr>
                <tr>
                    <th>图片</th>

                    <td>
                        <input type="text" name="goodsImage">
                    </td>
                </tr>
            </table>
            <table style="margin-bottom: 40px">
                <tr>
                    <td>
                        <div class="operationDiv">
                            <span class="editTableSpan" id="addTrue">确定</span>
                            <span style="margin-left: 50px" class="layui-layer-close editTableSpan">返回</span>
                        </div>

                    </td>
                </tr>
            </table>
        </form>
    </div>
</div>
<!--修改商品-->
<div class="m-modal">
    <div class="m-modal-dialog">
        <div class="m-top">
            <h4 class="m-modal-title">
                修改商品
            </h4>
            <span class="m-modal-close">&times;</span>
        </div>
        <div class="m-middle">
            <form action="" method="post" id="editF">
                <table class="EditTable" id="EditTables">
                    <tr>
                        <th>商品分类</th>
                        <td>
                            <select name="goodsCategory" id="goodsCategoryS" autocomplete="off">
                                <option value="1">杂货</option>
                                <option value="2">家用</option>
                                <option value="3">个人护理</option>
                                <option value="4">包装食品</option>
                                <option value="5">饮料&酒水</option>
                                <option value="6">水果</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>商品类型</th>
                        <td>
                            <select name="goodsType" id="goodsTypeS" autocomplete="off">
                                <option value="1">今日热卖</option>
                                <option value="2">今日优惠</option>
                                <option value="3">新品推荐</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th>商品名称</th>
                        <td>
                            <input type="text" name="goodsName">
                        </td>
                    </tr>
                    <tr>
                        <th>商品简介</th>
                        <td>
                            <input type="text" name="goodsIntroduce">
                        </td>
                    </tr>
                    <tr>
                        <th>原价（元）</th>
                        <td>
                            <input type="text" name="goodsPrice">
                        </td>
                    </tr>
                    <tr>
                        <th>现价（元）</th>
                        <td>
                            <input type="text" name="goodsOfferPrice">
                        </td>
                    </tr>
                    <tr>
                        <th>数量</th>

                        <td>
                            <input type="number" name="goodsNum">
                        </td>
                    </tr>
                    <tr>
                        <th>图片</th>
                        <td>
                            <input type="text" name="goodsImage">
                        </td>
                    </tr>
                </table>
                <table style="margin:20px 0 40px 0">
                    <tr>
                        <td>
                            <div class="operationDiv">
                                <button type="submit" class="editTableSpan" id="addC">确定</button>
                                <span class="m-modal-close editTableSpan" style="margin-left: 50px;">返回</span>
                            </div>
                        </td>
                    </tr>
                </table>
            </form>
        </div>

    </div>
</div>
</body>
<script>
    $.ajax({
        url:url+'goods/getGoodsList/0/0/1/100',
        type:'POST',
        success:function (data) {
            if (data.code == 0) {
                var data = data.data;
                var str = '<tr><th>商品名称</th><th>价格（元）</th><th>类别</th>><th>数量</th><th>管理</th></tr>';
                for (var i = 0; i < data.length; i++) {
                    str += '<tr><td>' + data[i].goodsName + '</td>' +
                        '<td style="color: red">' + data[i].goodsPrice + '</td>';
                    if(data[i].goodsCategory == 1){
                        str += '<td>杂货</td>';
                    }else if(data[i].goodsCategory == 2){
                        str += '<td>家用</td>';
                    }else if(data[i].goodsCategory == 3){
                        str += '<td>个人护理</td>';
                    }else if(data[i].goodsCategory == 4){
                        str += '<td>包装食品</td>';
                    }else if(data[i].goodsCategory == 5){
                        str += '<td>饮料&酒水</td>';
                    }else if(data[i].goodsCategory == 6){
                        str += '<td>水果</td>';
                    }
                    str += '<td>' + data[i].goodsNum + '</td>'+
                    '<td><span class="editSpan" id="'+ data[i].id +'" style="margin-right: 10px">编辑</span><span class="deleteSpan" id="'+ data[i].id +'">删除</span></td>';
                }
                $('#commodityFrom table').html(str);
                edit();

            }
        }
    })

    $('#commodityEdit').hide();
    $('.addCommodity').click(function () {
        layer.open({
            type: 1,
            shade: 0.5,
            title: false, //不显示标题
            anim:1,
            area: ['670px', '408px'],
            content: $('#commodityEdit'), //捕获的元素，注意：最好该指定的元素要存放在body最外层，否则可能被其它的相对元素所影响
            cancel: function() {

            }
        });
        $('#addForm').attr('action',url+'goods/addGoods');
        $('#addTrue').click(function () {
            $("#addForm").ajaxSubmit(function () {
                layer.msg("添加商品成功！");
                setTimeout(function () {
                    window.parent.location.reload();

                },1500)
            });
            return false;
        })
    });
    //修改商品
    function edit() {
        var m1 = new MyModal.modal(function() {
            alert("你点击了确定");
        });
        $('.editSpan').on("click", function() {
            m1.show();
            var id = $(this).attr('id');
            $.ajax({
                url:url+'goods/getGoodsById/'+id,
                type:'POST',
                success:function (datas) {
                    if(datas.code == 0){
                        var data = datas.data;
                        console.log(data.goodsCategory);
                        if(data.goodsCategory === 1 || data.goodsCategory === ''){
                            $('#goodsCategoryS option').eq(0).prop("selected",true);
                        }else if(data.goodsCategory === 2){
                            $('#goodsCategoryS option').eq(1).prop("selected",true);
                        }else if(data.goodsCategory === 3){
                            $('#goodsCategoryS option').eq(2).prop("selected",true);
                        }else if(data.goodsCategory === 4){
                            $('#goodsCategoryS option').eq(3).prop("selected",true);
                        }else if(data.goodsCategory === 5){
                            $('#goodsCategoryS option').eq(4).prop("selected",true);
                        }else if(data.goodsCategory === 6){
                            $('#goodsCategoryS option').eq(5).prop("selected",true);
                        }
                        if(data.goodsType === 1 || data.goodsType === ''){
                            $('#goodsTypeS option').eq(0).prop("selected",true);
                        }else if(data.goodsType === 2){
                            $('#goodsTypeS option').eq(1).prop("selected",true);
                        }else if(data.goodsType === 3){
                            $('#goodsTypeS option').eq(2).prop("selected",true);
                        }
                        $('#EditTables input').eq(0).val(data.goodsName);
                        $('#EditTables input').eq(1).val(data.goodsIntroduce);
                        $('#EditTables input').eq(2).val(data.goodsPrice);
                        $('#EditTables input').eq(3).val(data.goodsOfferPrice);
                        $('#EditTables input').eq(4).val(data.goodsNum);
                        $('#EditTables input').eq(5).val(data.goodsImage);
                    }
                }
            });

            $('#editF').attr('action',url+'goods/updateGoods/'+id);
            $('#addC').click(function () {
                $("#editF").ajaxSubmit(function () {
                    layer.msg("修改商品成功！");
                    setTimeout(function () {
                        window.parent.location.reload();
                    },1500)
                });
                return false;
            })
        });
        //删除
        $('.deleteSpan').click(function () {
            var id = $(this).attr('id');
            var _this = this;
            layer.confirm('确定删除该商品吗？', {
                title:'',
                btn: ['确实','取消'] //按钮
            }, function(){
                $.ajax({
                    url:url+'goods/deleteGoodsById/'+id,
                    type:'POST',
                    success:function (data) {
                        if (data.code == 0) {
                            $(_this).parent().parent().remove();
                            layer.msg("删除商品成功！");
                            setTimeout(function () {
                                window.parent.location.reload();
                            },1500)
                        }
                    }
                })
            }, function(){
                layer.msg("删除商品失败！");
            });

        })
    }

    //分页

</script>
</html>
